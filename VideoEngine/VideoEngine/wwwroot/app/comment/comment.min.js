function init(e,t){lComments(e,0,0,0);sPagination(e);loader("jct_loader","",e)}function cCmts(e,t){loader("jct_loader","loading...",e);$.ajax({type:"GET",url:e.rootUrl+""+e.loadHandler,data:"cid="+e.contentID+"&ctp="+e.contentType+"&action=cnt",success:function(n){loader("jct_loader","",e);if(n.indexOf("error")!=-1)Display_Message("#jct_msg",n,0);else{var r=JSON.parse(n);if(r.status=="error"){Display_Message("#jct_msg",r.message,0)}else{$("#jct_counter").html(r.comments);e.tComments=r.comments;init(e,t)}}}})}function cremove(e,t){var n=$(t).parents().data("id");var r=$(t).parents().data("user");if(r==e.userName){gtken(e.rootUrl,"jct_msg");$.ajax({type:"GET",url:e.rootUrl+""+e.processHandler,data:"id="+n+"&usr="+r+"&isadm="+e.isAdmin+"&action=rem&nm="+gtgn()+"&tk="+gttk(),success:function(e){var t=JSON.parse(e);if(t.status=="error"){Display_Message("#jct_msg",t.message,0)}else{$("#"+n).hide();Display_Message("#jct_msg",t.message,1)}}})}}function cvote(e,t){var n=$(t).data("type");var r=$(t).parents().data("id");var i=$(t).parents().data("votes");var s=$(t).parents().data("user");var o=0;switch(n){case"vup":o=0;break;case"vdown":o=1;break;case"flg":o=2;break}$(".vteh").removeClass("voteactive");gtken(e.rootUrl,"jct_msg");$.ajax({type:"GET",url:e.rootUrl+""+e.processHandler,data:"val="+o+"&id="+r+"&vt="+i+"&usr="+s+"&isadm="+e.isAdmin+"&action=vote&nm="+gtgn()+"&tk="+gttk(),success:function(e){var n=JSON.parse(e);if(n.status=="error"){$(t).addClass("voteerror")}else{$(t).addClass("voteactive");if(o!=2){if(o==0){i++;$("#repcnt_"+r).addClass("voteup")}else{i--;$("#repcnt_"+r).addClass("votedown")}$("#repcnt_"+r).html(i)}}$(t).attr("title",n.message);$(t).popover()}})}function cpost(e,t,n){if(e.userName==""){Display_Message("#jct_msg",e.loginMsg,0);return}var r="jct_post";if(t>0)r=r+"_"+t;var i=$("#"+r).val();if(i==""){Display_Message("#jct_msg",e.requiredMsg,0);return}pComments(e,i,t,n);jCmt_Reset(t)}function preparePost(e,t,n){var r='<div class="jct_post" data-level="'+n+'" data-id="'+t+'">';var i=e.width;var s=e.avatorWith+15;if(t==0){r+='<div id="jct_msg"></div>';r+='<div class="'+e.headingCss+'">'+e.headingCaption+' (<span id="jct_counter">'+e.tComments+"</span>)</div>"}else{if(n>0)s=e.avatorWith-1;i=i-s*(n+1)}if(!e.showAvator){i=e.width;if(t>0)i=i-8;if(n>0)i=i-(s*n+10)}r+='<div class="'+e.postCss+'" style="width:'+i+'px;" ><fieldset>';if(e.showAvator){var o=e.width-e.avatorWith-10;var u=e.avatorWidth;if(t>0){u=u-25;o=i-(u+10)}var a=preparerUrl(e.profileUrl,e.userName);r+='<div><div class="pull-left" style="width:'+u+'px;">\n';r+='<a href="'+a+'">\n';r+='<img class="'+e.avatorCss+'" src="'+e.avatorUrl+'" alt="'+e.avatorTooltip+'">\n';r+="</a>\n";r+="</div>";r+='<div class="pull-right" style="width:'+o+'px;">\n'}var f="jct_post";if(t>0){$(".postcnt").html("");f="jct_post_"+t}r+='<label class="sr-only" for="'+f+'">'+e.postLabel+"</label>\n";r+='<textarea id="'+f+'" name="'+f+'" class="form-control jctpost" placeholder="'+e.placeHolder+'" rows="'+e.postRows+'"></textarea>\n';if(e.enablePostBtn){r+='<div class="'+e.postBtnContainerCss+'">\n';r+='<button id="jct_btn" class="'+e.postBtnCss+' jbtn">'+e.postBtnCaption+"</button>\n";r+="</div>\n"}if(e.showAvator)r+="</div></div>";r+="</fieldset></div>";r+="</div>\n";if(t==0){r+='<div style="width:'+e.width+'px;">';r+='<div id="jct_loader"></div>';r+='<div id="jct_list"></div>';r+='<div id="jct_smld"></div>';r+='<div id="jct_page"></div>';r+="</div>"}return r}function pComments(e,t,n,r){loadingmessage("jct_loader","processing...");gtken(e.rootUrl,"jct_msg");$.ajax({type:"POST",url:e.rootUrl+""+e.processHandler,data:"val="+t+"&cid="+e.contentID+"&ctp="+e.contentType+"&rid="+n+"&isadm="+e.isAdmin+"&tcmts="+e.tComments+"&apr="+e.autoApproved+"&level="+r+"&ausr="+e.userName+"&curl="+e.contentUrl+"&ctitle="+e.contentTitle+"&action=post&nm="+gtgn()+"&tk="+gttk(),success:function(t){var r=JSON.parse(t);loadingmessage("jct_loader","");if(e.autoApproved){getComment(r,e,1,n,0)}else Display_Message("#jct_msg",e.reviewMsg,1);updateStats(e)}})}function lComments(e,t,n,r){var i=e.selectedPage;if(t>0)i=1;if(r==1){loader("jct_smld","loading comments...",e)}else if(t==0)loader("jct_loader","loading comments...",e);$.ajax({type:"GET",url:e.rootUrl+""+e.loadHandler,data:"cid="+e.contentID+"&ctp="+e.contentType+"&isa="+e.showAvator+"&rid="+t+"&isall="+n+"&ps="+e.pageSize+"&p="+i,success:function(i){var s=JSON.parse(i);if(r==1)loader("jct_smld","",e);else if(t==0)loader("jct_loader","",e);if(typeof s.status!="undefined"){Display_Message("#jct_msg",s.message,0)}else if(s.length==0&&t==0){$("#jct_list").html("<h3>"+e.norecordMsg+"</h3>")}else{for(var o=0;o<s.length;o++){getComment(s[o],e,0,t,n);if(s[o].replies>0){lComments(e,s[o].id,n,0)}}sPagination(e)}}})}function updateStats(e){if(e.autoApproved){e.tComments++;$("#jct_counter").html(e.tComments)}}function getComment(e,t,n,r,i){var s="jct_list";if(i==1)s="pfull_"+r;else if(r>0)s="p_"+r;if(n==0)$("#"+s).append(setLayout(e,t));else $("#"+s).prepend(setLayout(e,t))}function setLayout(e,t){var n="";var r=0;var i=10;if(e.lcount>0){if(e.lcount>1)i=0;r=(t.avatorWidth+i)*e.lcount;n=' style="margin-left:'+r+'px;"'}var s="<div"+n+' id="'+e.id+'" class="citem">';var o=preparerUrl(t.profileUrl,e.username);if(t.showAvator){var u=t.width-t.avatorWith-15;var a=t.avatorWidth;if(e.lcount>0){a=a-25;u=$(".citem").width()-(r+a+5)}var f="";if(typeof e.picturename!="undefined")f=e.picturename;else if(t.userName==e.username)f=t.avatorPictureName;var l=t.thumbDirectoryPath;if(t.isMemberDirectory)l+=e.username+"/";l+="photos/thumbs/"+f;s+='<div class="pull-left" style="width:'+a+'px;">\n';s+='<a href="'+o+'">\n';s+='<img class="'+t.avatorCss+'" src="'+l+'" alt="'+t.avatorTooltip+'">\n';s+="</a>\n";s+="</div>";s+='<div class="pull-right" style="width:'+u+'px;">\n'}s+='<div class="citem-inner" data-id="'+e.id+'" data-level="'+e.lcount+'" data-votes="'+e.points+'" data-user="'+e.username+'">\n';if(t.showUser){s+='<a href="'+o+'" class="author">'+e.username+"</a>\n";if(t.authorStatus){if(e.username==t.userName)s+='<span class="label label-default">Author</span>\n'}}if(t.showDate)s+='<span class="pdate">'+e.cdate+"</span>\n";s+='<div class="pcomment">'+e.message+"</div>";if(t.showReply){if(t.replyLevel>0){var c=e.lcount+1;if(c<t.replyLevel)s+='<a href="#" class="preply">Reply</a>\n'}else{s+='<a href="#" class="preply">Reply</a>\n'}}if(e.points!=0){var h="voteup";if(e.points<0)h="votedown";s+='<span class="'+h+'" id="repcnt_'+e.id+'">'+e.points+"</span>\n"}else{s+='<span id="repcnt_'+e.id+'"></span>\n'}var p="vte";if(t.userName=="")p="signvte";if(t.showLike){if(t.likeStyle==0)s+='<a href="#" data-type="vup" class="'+p+' vote"><i class="icon icon-thumbs-up"></i></a>\n';else s+='<a href="#" data-type="vup" class="'+p+' vote">Like</a>\n'}if(t.showDislike){s+='<a href="#"  data-type="vdown" class="'+p+' vote"><i class="icon icon-thumbs-down"></i></a>\n'}if(t.showFlag){s+='<a style="display:none;" data-type="flg" id="pflag" href="#" class="'+p+' vote" title="report spam or abuse"><i class="icon icon-flag"></i></a>\n'}if(t.userName==e.username)s+='<a style="display:none;" href="#" class="remove" title="remove comment"><i class="icon icon-times"></i></a>\n';s+="</div>\n";s+='<div class="postcnt" id="pst_'+e.id+'"></div>\n';if(t.showAvator)s+="</div>";s+='<div class="clear"></div>\n';s+="</div>";if(e.replies>2&&e.lcount<1){r=t.avatorWidth+i;n=' style="margin-left:'+r+'px;"';s+='<div class="creplies"><a '+n+' class="author vrep" data-replies="'+e.replies+'" data-rid="'+e.id+'" href="#">View all '+e.replies+' replies</a> <i class="icon icon-chevron-down"></i></a>\n'}s+='<div class="repcnt" id="pfull_'+e.id+'"></div>\n';s+='<div class="repcnt" id="p_'+e.id+'"></div>\n';return s}function sPagination(e){if(e.tComments==0)return"";if(e.paginationType==3){$("#jct_page").html('<a href="#" class="lmore">Load more</a> <i class="icon icon-chevron-down"></i>\n')}else{if(e.tComments>e.pageSize)$("#jct_page").html(bPg(e))}}function bPg(e){var t="";var n=0;var r=0;var i="";var s=true;var o="#";var u="#";var a=true;var f="";var l="";if(e.tComments>e.pageSize){var c=Math.ceil(e.tComments/e.pageSize);if(e.selectedPage>1){if(s&&e.paginationType!=2){n=1;r=n+e.pageSize-1;i="showing "+n+" - "+r+" records of "+e.tComments+" records";backwardIcone="icon icon-backward";if(!a)backwardIcon="glyphicon glyphicon-backward";t+='<li><a data-id="1" href="'+o+'" class="pgcss" data-toggle="tooltip" title="'+i+'"><i class="'+backwardIcone+'"></i></a></li>\n'}n=(c-1)*e.pageSize;r=n+e.pageSize-1;if(r>e.tComments)r=e.tComments;i="showing "+n+" - "+r+" records of "+e.tComments+" records";var h=e.selectedPage-1;if(h<1)h=1;var p="";var d="icon icon-chevron-left";if(!a)d="glyphicon glyphicon-chevron-left";var v='<i class="'+d+'"></i>';if(e.paginationType==2){if(f!="")p=' class="'+f+'"';v="&larr; Previous"}t+="<li"+p+'><a data-id="'+h+'" href="'+u+'" class="pgcss" title="'+i+'">'+v+"</a></li>\n";if(e.paginationType!=2)t+=g_pagination_links(e,c);if(e.selectedPage<c)t+=g_prev_last_links(e,c)}else{if(e.paginationType!=2)t+=g_pagination_links(e,c);t+=g_prev_last_links(e,c)}}var m="pagination "+l;if(e.paginationType==2)m="pager";return'<ul class="'+m+'">\n'+t+"</ul>\n"}function g_pagination_links(e,t){var n="";var r=0;var s=0;var o="";var u=[];u=genPgLinks(e,t);if(u.length>0){for(i=0;i<u.length;i++){r=(u[i]-1)*e.pageSize+1;s=r+e.pageSize-1;if(s>e.tComments)s=e.tComments;o="showing "+r+" - "+s+" records  of "+e.tComments+" records";var a="";if(u[i]==e.selectedPage)a=' class="active"';n+="<li"+a+'><a data-id="'+u[i]+'" href="#" class="pgcss" title="'+o+'">'+u[i]+"</a></li>\n"}}return n}function g_prev_last_links(e,t){var n=true;var r="";var i="";var s=true;var o=e.selectedPage*e.pageSize+1;var u=o+e.pageSize-1;if(u>e.tComments)u=e.tComments;var a="showing "+o+" - "+u+" records of "+e.tComments+" records";pid=e.selectedPage+1;if(pid>t)pid=t;var f="";var l="icon icon-chevron-right";if(!n)l="glyphicon glyphicon-chevron-right";var c='<i class="'+l+'"></i>';if(e.paginationType==2){if(r!="")f=' class="'+r+'"';c="Next &rarr;"}i+="<li"+f+'><a data-id="'+pid+'" href="#" class="pgcss" data-toggle="tooltip" title="'+a+'">'+c+"</a></li>\n";if(s&&e.paginationType!=2){o=(t-1)*e.pageSize+1;u=o+e.pageSize-1;if(u>t)u=t;a="showing "+o+" - "+u+" records of "+e.tComments+" records";var h="icon icon-forward";if(!n)h="glyphicon glyphicon-forward";i+='<li><a data-id="'+t+'" href="#" class="pgcss" data-toggle="tooltip" title="'+a+'"><i class="'+h+'"></i></a></li>\n'}return i}function genPgLinks(e,t){var n=0;var r=[];if(t<e.paginationLinks){for(n=1;n<=t;n++){r[n-1]=n}}else{var i=e.selectedPage-Math.floor(e.paginationLinks/2);var s=e.selectedPage+Math.floor(e.paginationLinks/2);if(i<1){s=s+(1-i);i=1}if(s>t){i=i-(s-t);s=t}var o=0;for(n=i;n<=s;n++){r[o]=n;o++}}return r}function getFieldValue(e){if(e!=undefined)return e;else return""}function jCmt_Reset(e){var t="jct_post";if(e>0){t="jct_post_"+e}$("#"+t).val("")}function preparerUrl(e,t){var n=new RegExp("{p}");if(n.test(e))e=e.replace("{p}",t);return e}function loader(e,t,n){if(t==""){$("#jct_list").show();$("#"+e).html("")}else{$("#jct_list").hide();$("#"+e).html('<div class="loader"><img src="'+n.rootUrl+""+n.loaderFileName+'" /><br />'+t+"</div>")}}function gtgn(){return $("#gnm").html()}function gttk(){return $("#gtk").html()}function gtken(e,t){$.ajax({type:"GET",url:e+"include/security/gtoken.php",data:"act=1",success:function(e){if(e.status=="success"){$("#gnm").html(e.nm);$("#gtk").html(e.tk)}else{if($("#"+t).length>0)Display_Message("#"+t,"Token failed to generate",0)}}})}(function(e){e.fn.jComment=function(t){var n=e.extend({showAvator:false,avatorUrl:"#",avatorPictureName:"#",avatorWidth:65,contentID:0,contentUrl:"#",contentTitle:"",contentType:0,userName:"#",tComments:0,autoCount:false,width:500,postRows:2,placeHolder:"Share your thoughts",headingCss:"heading",headingCaption:"All Comments",postCss:"postcss",profileUrl:"#",avatorCss:"img-responsive img-rounded",avatorTooltip:"",postLabel:"Post Comment",postBtnContainerCss:"btncss",postBtnCss:"btn btn-xs btn-primary",postBtnCaption:"Post",isAuth:false,loginMsg:"Sign In to Post Comment",norecordMsg:"No records found",requiredMsg:"Please enter comment",reviewMsg:"Your comment has been posted and need to be reivewed",loaderMsg:"Loading...",rootUrl:"#",loadHandler:"jcomments/load.php",processHandler:"jcomments/handler.php",thumbDirectoryPath:"#",isMemberDirectory:true,enableEnter:true,enablePostBtn:true,autoApproved:true,isAdmin:false,loaderFileName:"jcomments/img/loader.gif",paginationType:1,paginationLinks:10,selectedPage:1,pageSize:20,showReply:true,showDate:true,showUser:true,replyLevel:3,showLike:true,showDislike:true,showFlag:true,likeStyle:0,authorStatus:false},t);e(this).addClass("jcomment");e(this).html(preparePost(n,0,0));if(n.autoCount){cCmts(n,this)}else{init(n,this)}e(this).on({click:function(t){var r=e(this).closest(".jct_post").data("id");var i=e(this).closest(".jct_post").data("level");cpost(n,r,i);return false}},".jbtn");e("#jct_list").on({click:function(t){var r=e(this).data("rid");var i=e("#pfull_"+r).html();if(i=="")lComments(n,r,1,0);e(this).closest(".creplies").find(".icon-chevron-down").addClass("icon-chevron-up");e(this).closest(".creplies").find(".icon-chevron-down").removeClass("icon-chevron-down");e(this).removeClass("vrep");e(this).addClass("hrep");e(this).html("Hide replies");e("#p_"+r).hide();e("#pfull_"+r).show();return false}},".vrep");e("#jct_list").on({click:function(t){var n=e(this).data("rid");var r=e(this).data("replies");e(this).closest(".creplies").find(".icon-chevron-up").addClass("icon-chevron-down");e(this).closest(".creplies").find(".icon-chevron-up").removeClass("icon-chevron-up");e(this).removeClass("hrep");e(this).addClass("vrep");e(this).html("Show all "+r+" replies");e("#p_"+n).show();e("#pfull_"+n).hide();return false}},".hrep");e("#jct_list").on({click:function(e){cremove(n,this);return false}},".remove");e("#jct_page").on({click:function(t){var r=e(this).data("id");n.selectedPage=r;e("#jct_list").html("");lComments(n,0,0,0);return false}},".pgcss");e("#jct_page").on({click:function(e){n.selectedPage++;lComments(n,0,0,1);return false}},".lmore");e("#jct_list").on({click:function(e){cvote(n,this);return false}},".vteh,.vte");e("#jct_list").on({click:function(e){Display_Message("#jct_msg",n.loginMsg,0);return false}},".signvte");e("#jct_list").on({click:function(t){var r=e(this).parents().data("id");var i=e(this).parents().data("level");e("#pst_"+r).html(preparePost(n,r,i));return false}},".preply");e(this).on({keypress:function(t){if(n.enableEnter){var r=t.keyCode?t.keyCode:t.which;if(r=="13"){var i=e(this).closest(".jct_post").data("id");var s=e(this).closest(".jct_post").data("level");cpost(n,i,s);return false}}}},".jctpost");e("#jct_list").on("mouseenter",".citem-inner",function(){e(this).find(".vote").addClass("voteh");e(this).find(".vote").removeClass("vote");e(this).find(".remove").show();e(this).find("#pflag").show()}).on("mouseleave",".citem-inner",function(){e(this).find(".voteh").addClass("vote");e(this).find(".voteh").removeClass("voteh");e(this).find(".remove").hide();e(this).find("#pflag").hide()})}})(jQuery)